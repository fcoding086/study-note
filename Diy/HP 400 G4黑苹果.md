# HP 400 G4黑苹果

作者：精灵的小妖

日期：2022-02-21

> 心仪苹果电脑很久了，奈何钱袋空空囊中羞涩，恰好收到1台HP ProDesk 400 G4主机，动手安装了黑苹果系统，希望可以给你带来参考。

## 资料准备

### 工具软件

#### **启动U盘制作工具**

**[etcher](https://etcher.io/)**

#### **修改三码的工具**

opencoreconfig

#### 生成三码的工具

HackinTool

### 系统映像

迅雷下载：https://mirrors.dtops.cc/ISO/MacOS/macOS%20Monterey%2012.1%2021C52%20Installer%20for%20CLOVER%205143%20and%20FirPE.dmg

### 引导文件

感谢B站大佬《**机汤TV**》的分享

百度网盘：链接: https://pan.baidu.com（去掉我）/s/1tH9-UnKgnhHqgZrYFgWCgw 提取码: 9q2p

### 其他硬件

有线键盘

有线鼠标

DP连接线及显示器（实测VGA安装过程中会不可用）

无线网卡

<!--该主机自带的网卡可能不支持黑苹果系统，请留意更换-->

<!--该EFI默认都支持943224博通653开头的网卡，94360CS2也免驱，其他需要自行调试-->

## 制作启动U盘

```
# 安装U盘制作工具
双击etcher软件安装包，安装该软件

# 制作启动U盘
1、双击桌面的balenaEtcher图标，运行该软件
2、选择Flash from file（默认就是该选项）
3、在文件系统中找到下载好的系统映像文件（.ISO结尾），点击开始
4、等待程序运行完成，启动U盘初步完成

# 替换EFI文件
1、打开文件管理器，启动U盘的默认名称为“PE”
2、打开启动U盘，将其中的EFI文件夹替换为我们提前下载好的EFI文件（详见 引导文件 ）
3、此时，启动U盘制作完成

```



## 系统安装

### 修改BIOS

```
1、HP主机连接有线键盘和有线鼠标，插入启动U盘，接通电源
2、短按开机键，按键盘ESC进入BIOS设置界面
3、语言设置选择“中文”
4、恢复出厂设定
5、“先进”里面“启动选项”去掉一些开机项
	取消快速引导
	取消网络（PXE）引导
	取消内存大小变更时提醒
6、“安全引导配置”禁用传统支持和禁用安全引导
7、“内置设备选项”修改显存大小为64MB
8、将硬盘引导顺序修改为U盘引导为第一顺序
9、F10保存退出
```

### 引导安装

修改完BIOS并保存后，主机进入U盘引导启动，将进入黑苹果系统安装引导

此时U盘引导有几个重要选项，包括PE引导和安装苹果系统引导

```
# 进入PE引导
1、在U盘引导页面，选择PE引导，进入PE系统页面
2、选择硬盘工具，将要安装黑苹果的硬盘修改为GUID分区表（GPT），记得保存操作以执行该操作
3、重启

# 进入安装苹果系统引导
1、在U盘引导页面，选择安装苹果系统，进入系统安装页面
2、点击页面左上角File，切换语言至中文
3、选择硬盘工具，格式化要安装系统的硬盘
4、选择安装系统，在安装过程中填写必要信息，跳过需登录的操作步骤，等待系统安装完成
5、系统安装完成，此时，系统引导仍在启动U盘中

# 系统引导迁移
1、进入已安装好的黑苹果系统
2、打开 终端，输入以下命令挂载EFI分区
	diskutil list     //列出当前硬盘和硬盘分区
	sudo diskutil mount disk0s1		//挂载系统盘EFI分区，分区编号通常为disk0s1
	sudo diskutil moutn disk1s1		//挂载启动U盘EFI分区，分区编号按需调整
3、将启动U盘EFI下所有文件拷贝覆盖系统盘EFI下所有文件
4、弹出启动U盘（不弹出下次连接可能需重新命令行挂载），拔掉启动U盘
5、重启主机
6、检查系统是否可引导进入，通常系统可直接进入黑苹果系统。如无法进入系统，请插入启动U盘，重启主机即可进入系统，再重新拷贝覆盖系统盘的EFI
```



## 修改三码

```
# 挂载EFI
1、打开系统终端APP，输入以下命令挂载FEI分区
	diskutil list     //列出当前硬盘和硬盘分区
	sudo diskutil mount disk0s1		//挂载系统盘EFI分区，分区编号通常为disk0s1
2、进入/EFI/OC,找到config.plist文件

# 生成新三码
1、打开HackinTool工具，生成新的三码（序列号、UUID、主板序列号）

# 检查序列号是否可用
1、访问苹果官网，https://checkcoverage.apple.com/cn/zh
2、输入新生成的序列号，查询
3、如新序列号查询不到，则可用
4、如新序列号可查到，则再生成新序列号，直到序列号查询不到为止

# 修改config.plist文件
1、找到config.plist文件，使用opencorecinfig软件打开
2、在软件中，找到platforminfo-机型平台设置
3、选择 DataHub-Generic-platformNVRAM
4、将生成的新三码填入对应的位置
5、点击保存，务必保存才能生效
6、重启主机
7、进入系统后，点击菜单栏的苹果图标，检查“关于本机”中序列号，是否已修改为新序列号
8、如序列号修改不成功，请重复上述步骤
9、如序列号已变为新序列号，恭喜你，洗白成功，可放心登录Apple ID了
```



## 更换网卡

```
# HP主机拆机
1、主机正面（有开机键那面）朝向你
2、扭掉背面中间的螺丝
3、将主机上盖向你的方向推，即可打开主机
4、拆掉主板左侧的2.5寸硬盘支架，下方即是固态硬盘位和网卡位

# 更换网卡
这里采用的是BCM94360CS2+反向转接卡，一定要用**反向转接卡**，一是网卡接口不一样，另一个是网卡位空间限制必须反接
1、将原网卡的天线拆下来
2、将新网卡连接天线
	i.可用额外的天线，自己外接天线即可
	ii.主机天线长度可能不够需要延长线，延长线接口可能不稳定，可用打火机加热塑胶管固定
3、安装完成后，将2.5寸硬盘之间安装回去，注意小心，因为网卡+转接卡厚度还是很厚的
4、 将主机上盖安装回去

# 网卡测试
1、测试无线Wi-Fi连接，可用（有线始终可用）
2、测试AirDrop，可用
3、测试随航Handoff，不可用，原因未知
```



## 总结

HP ProDesk 400 G4黑苹果安装完毕

我自己是使用了512G固态作为系统盘，又额外加了一块2T机械硬盘用来存放资源文件。

至此，黑苹果的鼓捣之旅告一段落。后续我会安装一些常用软件，期待苹果系统给我带来的新体验。

## 参考资料

https://blog.daliansky.net/

https://www.bilibili.com/video/BV1hq4y1c7t7?spm_id_from=333.999.0.0



